name: git-init

on: [push]

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v1
    - name: git init help
      run:  |
        source bin/functions.sh
        list-options-for-git-command init
        diff <(list-options-for-git-command init) commands/git-init-options.txt
        git init --help
    - name: git init (normal usage)
      run:  |
        cd ${HOME}
        rm -rf ${HOME}/workspace/git-init
        mkdir -p ${HOME}/workspace/git-init
        cd ${HOME}/workspace/git-init
        git init
        git config user.email "user1@gmail.com"
        git config user.name "User 1"
        ls -la
        git status
        echo "content" > file-1.txt
        git add file-1.txt
        git status
        git commit -m "added file-1.txt"
        git status
        git log
    - name: git init --bare / status - incorrect usage
      run:  |
        cd ${HOME}
        rm -rf ${HOME}/workspace/git-init
        mkdir -p ${HOME}/workspace/git-init
        cd ${HOME}/workspace/git-init
        git init --bare
        git status || echo
    - name: git init --bare - as repository
      run:  |
        cd ${HOME}
        rm -rf ${HOME}/workspace/git-init
        mkdir -p ${HOME}/workspace/git-init
        cd ${HOME}/workspace/git-init
        git init --bare
        rm -rf ${HOME}/workspace/git-init-2
        mkdir -p ${HOME}/workspace/git-init-2
        cd ${HOME}/workspace/git-init-2
        git clone ${HOME}/workspace/git-init
        cd ${HOME}/workspace/git-init-2/git-init
        echo "Log of workspace-2"
        git log || echo
        git status || echo
        git config user.email "user1@gmail.com"
        git config user.name "User 1"
        echo "content" > file-1.txt
        git add file-1.txt
        git commit -m "added file-1.txt"
        git log
        git push origin
        rm -rf ${HOME}/workspace/git-init-3
        mkdir -p ${HOME}/workspace/git-init-3
        cd ${HOME}/workspace/git-init-3
        git clone ${HOME}/workspace/git-init
        cd ${HOME}/workspace/git-init-3/git-init
        echo "Log of workspace-3"
        git log || echo
        git status || echo
    - name: git init --separate-git-dir
      run:  |
        cd ${HOME}
        rm -rf ${HOME}/workspace/git-init
        mkdir -p ${HOME}/workspace/git-init
        cd ${HOME}/workspace/git-init
        git status || echo
        git init --separate-git-dir=./.something-else
        ls -la
        cat .git
        git status || echo
    - name: git init --shared - share is not allowed (default)
      run:  |
        cd ${HOME}
        rm -rf ${HOME}/workspace/git-init
        mkdir -p ${HOME}/workspace/git-init
        cd ${HOME}/workspace/git-init
        umask 007
        git init --shared=false
        ls -ld .git
    - name: git init --shared - group share
      run:  |
        cd ${HOME}
        rm -rf ${HOME}/workspace/git-init
        mkdir -p ${HOME}/workspace/git-init
        cd ${HOME}/workspace/git-init
        umask 007
        git init --shared=true
        ls -ld .git
    - name: git init --shared - all
      run:  |
        cd ${HOME}
        rm -rf ${HOME}/workspace/git-init
        mkdir -p ${HOME}/workspace/git-init
        cd ${HOME}/workspace/git-init
        umask 007
        git init --shared=all
        ls -ld .git
    - name: git init --shared - octal - nonsense value just to prove a point
      run:  |
        cd ${HOME}
        rm -rf ${HOME}/workspace/git-init
        mkdir -p ${HOME}/workspace/git-init
        cd ${HOME}/workspace/git-init
        umask 007
        git init --shared=0707
        ls -ld .git
    - name: git init --template
      run:  |
        cd ${HOME}
        rm -rf ${HOME}/git-templates
        mkdir -p ${HOME}/git-templates
        echo "garbage" > ${HOME}/git-templates/garbage.txt
        rm -rf ${HOME}/workspace/git-init
        mkdir -p ${HOME}/workspace/git-init
        cd ${HOME}/workspace/git-init
        git init --template=${HOME}/git-templates
        ls -laR .git
